---
type: "manual"
---

# 管理员功能测试方案

## 📋 测试概览

本文档提供了GistFans项目管理员功能的完整测试计划，包括权限控制、功能验证、安全性测试等。

## 🔐 管理员权限控制测试

### 1. 访问权限验证

#### 测试用例1.1：未登录用户访问管理员页面
**测试步骤：**
1. 在浏览器中清除所有cookies和session
2. 直接访问 `http://localhost:3000/admin-dashboard`
3. 验证是否被重定向到登录页面

**预期结果：**
- 应该被重定向到 `/auth/signin` 或显示未授权错误
- 不应该能够访问任何管理员功能

#### 测试用例1.2：普通用户访问管理员页面
**测试步骤：**
1. 使用普通用户账号登录
2. 尝试访问 `http://localhost:3000/admin-dashboard`
3. 验证权限检查是否生效

**预期结果：**
- 应该显示权限不足的错误信息
- 不应该能够看到管理员界面

#### 测试用例1.3：管理员用户正常访问
**测试步骤：**
1. 使用管理员账号登录（或使用开发模式）
2. 访问 `http://localhost:3000/admin-dashboard`
3. 验证是否能正常访问管理员界面

**预期结果：**
- 能够正常访问管理员界面
- 显示完整的管理员功能菜单

### 2. API权限控制测试

#### 测试用例2.1：管理员API访问控制
**测试API端点：**
- `/api/admin/users` - 用户管理
- `/api/admin/invite-codes` - 邀请码管理
- `/api/admin/actions` - 管理员操作
- `/api/admin/generate-invite-code` - 生成邀请码

**测试步骤：**
1. 使用不同权限级别的用户测试每个API
2. 验证权限检查是否正确
3. 检查错误响应格式是否统一

**预期结果：**
- 只有管理员能够访问这些API
- 非管理员访问应返回403 Forbidden
- 错误响应格式应该统一

## 🛠️ 管理员功能测试

### 3. 用户管理功能

#### 测试用例3.1：用户列表查看
**测试步骤：**
1. 登录管理员账号
2. 进入用户管理页面
3. 验证用户列表是否正确显示

**验证项目：**
- [ ] 用户列表是否完整显示
- [ ] 用户信息是否准确（姓名、邮箱、角色等）
- [ ] 分页功能是否正常
- [ ] 搜索功能是否有效

#### 测试用例3.2：用户权限管理
**测试步骤：**
1. 选择一个普通用户
2. 尝试修改用户角色
3. 验证权限变更是否生效

**验证项目：**
- [ ] 角色修改是否成功保存
- [ ] 权限变更是否立即生效
- [ ] 操作日志是否正确记录

### 4. 邀请码管理功能

#### 测试用例4.1：邀请码生成
**测试步骤：**
1. 进入邀请码管理页面
2. 点击"生成新邀请码"按钮
3. 设置邀请码参数（使用次数、过期时间等）
4. 确认生成

**验证项目：**
- [ ] 邀请码是否成功生成
- [ ] 邀请码格式是否正确
- [ ] 参数设置是否生效
- [ ] 邀请码是否在列表中显示

#### 测试用例4.2：邀请码使用统计
**测试步骤：**
1. 查看邀请码列表
2. 验证使用统计信息
3. 测试邀请码的实际使用

**验证项目：**
- [ ] 使用次数统计是否准确
- [ ] 剩余次数计算是否正确
- [ ] 过期状态是否正确显示
- [ ] 邀请码使用后统计是否更新

### 5. 系统统计功能

#### 测试用例5.1：用户统计
**测试步骤：**
1. 查看管理员仪表板
2. 验证用户统计数据
3. 对比数据库实际数据

**验证项目：**
- [ ] 总用户数是否准确
- [ ] 新增用户数是否正确
- [ ] 活跃用户数是否合理
- [ ] 用户增长趋势是否正确

#### 测试用例5.2：邀请码统计
**测试步骤：**
1. 查看邀请码统计信息
2. 验证各项数据的准确性

**验证项目：**
- [ ] 总邀请码数量
- [ ] 已使用邀请码数量
- [ ] 邀请成功率统计
- [ ] 邀请码使用趋势

## 🔒 安全性测试

### 6. 权限绕过测试

#### 测试用例6.1：直接API调用测试
**测试步骤：**
1. 使用普通用户的session token
2. 直接调用管理员API
3. 验证是否能绕过权限检查

**测试工具：**
- Postman或curl命令
- 浏览器开发者工具

**验证项目：**
- [ ] API是否正确验证用户权限
- [ ] 是否存在权限绕过漏洞
- [ ] 错误响应是否泄露敏感信息

#### 测试用例6.2：Session劫持防护
**测试步骤：**
1. 获取管理员session token
2. 在不同浏览器/设备上使用
3. 验证安全机制是否生效

**验证项目：**
- [ ] Session是否有适当的过期时间
- [ ] 是否有IP地址验证
- [ ] 是否有异常登录检测

### 7. 输入验证测试

#### 测试用例7.1：邀请码生成参数验证
**测试步骤：**
1. 尝试输入异常参数
2. 验证输入验证是否有效

**测试数据：**
- 负数使用次数
- 过长的邀请码
- 特殊字符注入
- SQL注入尝试

**验证项目：**
- [ ] 输入验证是否完整
- [ ] 错误处理是否安全
- [ ] 是否存在注入漏洞

## 📊 性能测试

### 8. 大数据量测试

#### 测试用例8.1：大量用户数据加载
**测试步骤：**
1. 创建大量测试用户数据
2. 测试用户列表加载性能
3. 验证分页功能效果

**性能指标：**
- [ ] 页面加载时间 < 3秒
- [ ] API响应时间 < 1秒
- [ ] 内存使用是否合理
- [ ] 数据库查询是否优化

#### 测试用例8.2：并发操作测试
**测试步骤：**
1. 模拟多个管理员同时操作
2. 测试系统并发处理能力
3. 验证数据一致性

**验证项目：**
- [ ] 并发操作是否正常
- [ ] 数据是否保持一致
- [ ] 是否有竞态条件
- [ ] 错误处理是否完善

## 🧪 自动化测试脚本

### 9. 测试脚本示例

#### 权限验证脚本
```bash
#!/bin/bash
# 管理员权限测试脚本

echo "测试未授权访问..."
curl -X GET http://localhost:3000/api/admin/users \
  -H "Content-Type: application/json" \
  -w "HTTP Status: %{http_code}\n"

echo "测试管理员访问..."
curl -X GET http://localhost:3000/api/admin/users \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -w "HTTP Status: %{http_code}\n"
```

#### 邀请码功能测试脚本
```bash
#!/bin/bash
# 邀请码功能测试脚本

echo "生成邀请码..."
INVITE_CODE=$(curl -X POST http://localhost:3000/api/admin/generate-invite-code \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $ADMIN_TOKEN" \
  -d '{"maxUses": 10, "expiresAt": "2025-12-31"}' \
  | jq -r '.inviteCode.code')

echo "测试邀请码使用..."
curl -X POST http://localhost:3000/api/auth/register \
  -H "Content-Type: application/json" \
  -d "{\"inviteCode\": \"$INVITE_CODE\", \"email\": \"test@example.com\"}"
```

## 📝 测试报告模板

### 10. 测试结果记录

#### 测试执行记录表
| 测试用例 | 执行时间 | 测试结果 | 问题描述 | 修复状态 |
|----------|----------|----------|----------|----------|
| 1.1 | 2025-07-27 | ✅ 通过 | - | - |
| 1.2 | 2025-07-27 | ❌ 失败 | 权限检查不完整 | 待修复 |
| ... | ... | ... | ... | ... |

#### 安全问题记录表
| 问题等级 | 问题描述 | 影响范围 | 修复建议 | 状态 |
|----------|----------|----------|----------|------|
| 高 | 权限绕过漏洞 | 管理员功能 | 加强权限验证 | 修复中 |
| 中 | 输入验证不足 | 邀请码生成 | 添加输入验证 | 待修复 |
| ... | ... | ... | ... | ... |

## 🎯 测试完成标准

### 11. 通过标准

管理员功能测试通过需要满足以下条件：

#### 功能性要求
- [ ] 所有核心功能正常工作
- [ ] 权限控制完全有效
- [ ] 数据统计准确无误
- [ ] 错误处理完善

#### 安全性要求
- [ ] 无权限绕过漏洞
- [ ] 输入验证完整
- [ ] Session管理安全
- [ ] 敏感信息保护

#### 性能要求
- [ ] 页面加载时间合理
- [ ] API响应速度快
- [ ] 大数据量处理正常
- [ ] 并发操作稳定

#### 可用性要求
- [ ] 界面友好易用
- [ ] 操作流程清晰
- [ ] 错误提示明确
- [ ] 帮助文档完整

---

**注意事项：**
1. 测试前请备份数据库
2. 使用测试环境进行测试
3. 记录所有测试结果
4. 及时修复发现的问题
5. 定期更新测试用例
